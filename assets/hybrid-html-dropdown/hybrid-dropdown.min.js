/*
Hybrid Dropdown JavaScript plugin insprired from an original idea by Sandrina Pereira (twitter:@a_sandrina_p)
Version: 2.2.1
Authors: Aurovrata Venet
Twitter: @aurovrata
GitHub: https://github.com/aurovrata/hybrid-html-dropdown
*/
class HybridDDError extends Error{constructor(e){super(e),this.name="HybridDropdownError"}}!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():e()}((function(){let e="undefined"!=typeof window?window:this,t=e.HybridDropdown=function(e,t){if(!(e&&e instanceof Element))throw new HybridDDError("HybridDropdown requires a DOM element to initialise.");if(e.classList.contains("hybridddised")&&e._hybriddd)return console.log("WARNING: attempting to instantiate element already converted to Hybrid Dropdown"),e._hybriddd;if(e.classList.contains("hybrid-dropdown"))return console.log("WARNING: attempting to instantiate Hybrid Dropdown element."),e;let d=this,i=1,l=!0,o=e.getAttribute("tabindex");if(d.isDS=!1,d.hasDd=!0,cnfg=Object.assign({},e.dataset),["class","id","name"].forEach((t=>{if(e.hasAttribute(t)){let d="field"+t.charAt(0).toUpperCase()+t.slice(1);if(cnfg[d]=e.getAttribute(t),"name"===t)e.removeAttribute(t),e.setAttribute(`data-hdd-${t}`,cnfg[d])}})),!0==("SELECT"===e.nodeName))e.multiple&&(i=-1),l=!1,!cnfg.fieldName&&cnfg.fieldId&&(cnfg.fieldName=cnfg.fieldId),cnfg.fieldId&&(cnfg.fieldId+="-hdd");else{if(d.isDS=!0,!t.dataSet){if(e.querySelector("script"))try{cnfg.dataSet=JSON.parse(e.querySelector("script").innerHTML)}catch(e){console.log(e.name+":"+e.message),console.log("HybridDropdown ERROR: missing or malformed json dataset")}else console.log("HybridDropdown ERROR: missing json dataset"),cnfg.dataSet=null}!cnfg.fieldName&&cnfg.fieldId&&(cnfg.fieldName=cnfg.fieldId),e.classList.add("hybriddd-custom")}if(e._hybriddd=d,d.el=e,d.el.classList.add("hybridddised"),Object.keys(cnfg).forEach((e=>{switch(e){case"limitSelection":case"gridColumns":cnfg[e]=parseInt(cnfg[e]);break;case"treeView":case"negative":case"colourise":case"multiple":case"checkboxes":cnfg[e]="true"==cnfg[e];break;case"selectedValues":cnfg[e].indexOf("[")>=0?cnfg[e]=JSON.parse(cnfg[e]):cnfg[e]=[cnfg[e]]}})),d.opt=Object.assign({},{dropdown:"vertical",gridColumns:!1,limitSelection:i,optionLabel:function(e){return"<span>"+e+"</span>"},selectedLabel:function(e){let t=Object.keys(e);return e[t[0]]+(t.length>1?"<span>[...]</span>":"")},defaultText:"---",treeView:!1,treeGlue:"/",fieldName:"hybriddd",backgroundColor:"",color:"",negative:!1,colourise:!0,checkboxes:l,tabIndex:o||0,listOption:null,selectedValues:[],fieldId:"",fieldClass:""},t,cnfg),"none"==d.opt.dropdown&&(d.hasDd=!1,(!Number.isInteger(d.opt.gridColumns)||d.opt.gridColumns<1)&&(d.opt.gridColumns=1)),d.opt.placeholder&&(d.opt.defaultText=d.opt.placeholder),(!Number.isInteger(d.opt.gridColumns)||d.opt.gridColumns<1)&&(d.opt.gridColumns=!1),d.opt.selectedValues.length>0&&(d.opt.selectedValues=d.opt.selectedValues.map(String)),["selectedLabel","optionLabel"].forEach((e=>{if(!(d.opt[e]&&d.opt[e]instanceof Function&&1==d.opt[e].length))throw new HybridDDError(`${e} setting must be a function with 1 argument.`)})),d.opt.listOption&&(!(d.opt.listOption instanceof Function)||2!=d.opt.listOption.length))throw new HybridDDError("listOption setting must be a function with 2 arguments.");return(d.opt.treeView||d.opt.multiple)&&d.opt.limitSelection<2&&(d.opt.limitSelection=-1),d.multi=1!=d.opt.limitSelection,d.multi&&d.opt.fieldName&&d.opt.fieldName.indexOf("[]")<0&&(d.opt.fieldName+="[]"),d.init(!0,!0,!0),d},d=t.prototype;return d.init=function(e,t,d){let i=this;if(e){i.hdd=null,i.isDS?(i.hdd=i.el,i.el.hasAttribute("tabindex")||i.hdd.setAttribute("tabindex",i.opt.tabIndex)):(i.hdd=document.createElement("div"),i.el.parentNode.insertBefore(i.hdd,i.el.nextSibling),i.hdd.style["margin-left"]="-"+i.el.getBoundingClientRect().width+"px",i.hdd.setAttribute("tabindex",i.opt.tabIndex)),i.hdd.setAttribute("id",i.opt.fieldId);let e=i.el.closest("label");e&&e.setAttribute("for",i.opt.fieldId),i.hdd.setAttribute("class",i.opt.fieldClass),i.hdd.classList.add("hybrid-dropdown"),i.hdd.selected=document.createElement("div"),i.hdd.appendChild(i.hdd.selected),i.hdd.selected.classList.add("hybriddd-selected"),i.hdd.listwrap=document.createElement("div"),i.hdd.appendChild(i.hdd.listwrap),i.hdd.ddlist=document.createElement("ul"),i.hdd.listwrap.appendChild(i.hdd.ddlist),i.hdd.listwrap.classList.add("hybriddd-wrapper"),i.hdd.ddlist.classList.add("hybriddd-options"),i.listenForBulk=!1,i.listenModClick=!1,i.hdd.classList.add("hybriddd-"+i.opt.dropdown)}if(t){let e=null;i.hdd.options={},i.hindex=[],i.sindex=[],i.value={};try{i.isDS?(i.hdd.classList.add("hybriddd-custom"),i.opt.dataSet?e=i.buildOptionList(Object.entries(i.opt.dataSet),0):(i.hdd.selected.innerHTML="<em>json error</em>",e=[])):e=i.buildOptionList(i.el.children,0),i.hdd.ddlist.replaceChildren(...e)}catch(e){if(!(e instanceof HybridDDError))throw e;console.log(e.name+":"+e.message),i.hdd.selected.innerHTML="<em>json error</em>"}}if(e){i.opt.gridColumns&&(i.hdd.listwrap.classList.add("hybriddd-grid"),i.hdd.listwrap.style.setProperty("--hybriddd-col",i.opt.gridColumns),i.hdd.ddlist.children[1]&&i.opt.gridColumns>1&&i.hdd.listwrap.style.setProperty("--hybriddd-item",i.hdd.ddlist.children[1].offsetWidth+"px")),i.isDS||i.event(i.el,"add",{change:i.updateFromOriginal.bind(i),focus:i.originalElementFocus.bind(i)}),i.change=i.inputChange.bind(i),i.event(i.hdd.ddlist,"add",{change:i.change}),i.hasDd&&(i.open=i.openSelect.bind(i),i.event(i.hdd,"add",{click:i.open}));let e=i.el.closest("form");e&&i.event(e,"add",{reset:i.reset.bind(i)}),i.hasDd&&(i.close=i.closeSelect.bind(i,!0)),i.blur=i.blurField.bind(i),i.hover=i.optionHover.bind(i),i.keyNav=i.keyboardNavigate.bind(i),i.event(i.hdd,"add",{keydown:i.keyNav}),i.refresh=i.refreshHybrid.bind(i),i.modClick=i.optionModClick.bind(i),i.emit("hybrid-dd-init")}i.opt.checkboxes&&i.hdd.classList.add("show-cb"),d&&i.colourise()},d.colourise=function(){let t=this,d=!1;if(!t.opt.colourise)return;if(!(e.hdd||t.opt.backgroundColor&&t.opt.color)){let i,l=!1,o=t.hdd;for(e.hdd={},form=o.closest("form"),form&&(o=form);!l&&o;){if(i=e.getComputedStyle(o,null),!e.hdd.bgColor&&!t.opt.backgroundColor)switch(i["background-color"]){case"transparent":case"":case"rgba(0, 0, 0, 0)":o=o.parentElement;break;default:e.hdd.bgColor=i["background-color"]}if(!e.hdd.color&&!t.opt.color)switch(i.color){case"transparent":case"":case"rgba(0, 0, 0, 0)":o=o.parentElement;break;default:e.hdd.color=i.color}e.hdd.bgColor&&e.hdd.color&&(l=!0),d=!0}l||(e.hdd.color||(e.hdd.color="#fff"),e.hdd.bgColor&&(e.hdd.bgColor="#5d5d5d"))}let i=t.opt.backgroundColor?t.opt.backgroundColor:e.hdd.bgColor,l=t.opt.color?t.opt.color:e.hdd.color;if(t.hdd.style["background-color"]=t.opt.negative?l:i,t.hdd.style.color=t.opt.negative?i:l,d){let e=document.createElement("style");e.setAttribute("id","hybriddd-colours"),e.type="text/css",e.innerText=`.hybriddd-option.active > label:hover,.hybriddd-option.hover > label,.hybriddd-option       > label:hover{color:${i};background-color:${l}}:hover > input:checked+.hybridddcb::before       {background-color:${i}}ul.hybriddd-options::-webkit-scrollbar-track {background:${i}}       ul.hybriddd-options::-webkit-scrollbar-thumb, ul.hybriddd-options::-webkit-scrollbar{background:${l}}       ul.hybriddd-options{scrollbar-color:${l} ${i}}`,document.head.appendChild(e)}if(t.opt.backgroundColor||t.opt.color||t.opt.negative){if(t.opt.negative){let e=i;i=l,l=e}let e=document.createElement("style"),d=t.hdd.getAttribute("id");e.setAttribute("id",d+"-css"),e.type="text/css",e.innerText=`#${d} .hybriddd-option.active > label:hover,#${d} .hybriddd-option.hover > label,#${d}       .hybriddd-option > label:hover{color:${i};background-color:${l}}#${d} :hover > input:checked + .hybridddl >       .hybridddcb::before {color:${l}} #${d} ul.hybriddd-options::-webkit-scrollbar-track {background:${i}}       #${d} ul.hybriddd-options::-webkit-scrollbar-thumb,#${d} ul.hybriddd-options::-webkit-scrollbar{background:${l}}       #${d} ul.hybriddd-options{scrollbar-color:${l} ${i};`,document.head.appendChild(e)}},d.refreshHybrid=function(e={}){let t=this,d=!1;if(e.hasOwnProperty("negative")||e.hasOwnProperty("colourise")||e.color||e.backgroundColor){d=!0;let e=t.el.getAttribute("id"),i=document.querySelector("style#"+e+"-css");i&&i.remove()}e.listOption&&(e.listOption instanceof Function&&2==e.listOption.length||(console.log("Hybriddd refresh error: listOption setting must be a function with 2 arguments."),e.listOption=null)),t.opt=Object.assign({},t.opt,e),t.init(!1,!0,d)},d.buildOptionList=function(e,t,d=""){let i=this,l=[],o=i.multi?"checkbox":"radio",s=i.opt.fieldName?' name="'+i.opt.fieldName+'"':"";if([].forEach.call(e,((e,n)=>{if(i.opt.listOption&&!0!==i.opt.listOption(e,n))return;let r,c,a=document.createElement("li"),h=!1,u=!1,p=!1,b=[],f="",g="";if(i.isDS)switch(r=e[0],c=null,!0){case e[1]instanceof Object&&!e[1].length:case 0===t&&e[1]instanceof Array:p=h=!0,e[1].label?(h=!1,c=e[0],f="hybridddis",r=i.opt.optionLabel(e[1].label),b=Object.entries(e[1]),b.splice(Object.keys(e[1]).indexOf("label"),1),p=b.length>0,u=i.opt.selectedValues.indexOf(d+c)>=0):b=Object.entries(e[1]);break;default:f="hybridddis",c=e[0],r=i.opt.optionLabel(e[1]),u=i.opt.selectedValues.indexOf(d+c)>=0}else if("OPTGROUP"===e.nodeName)p=h=!0,r=e.label,b=e.children;else f="hybridddin",r=e.text,c=e.value,u=e.selected;if(!0===h)a.innerHTML="<span>"+r+"</span>",a.classList.add("hybriddd-group");else{if(g="",u&&(i.value[c]=r,i.sindex.push(c),g=" checked"),a.setAttribute("tabindex","-1"),a.innerHTML=`<label class="hybriddd-l${t}"><input tabindex="-1" class="${f}" type="${o}" value="${d}${c}" ${s}${g}/><span class="hybridddcb"></span><span class="hybridddl">${r}</span></label>`,a.classList.value="hybriddd-option"+(u?" active":""),i.isDS||(a.classList.value+=` ${e.classList.value}`),i.hdd.options[d+c])throw new HybridDDError("Option list has duplicate value: "+c);i.hdd.options[d+c]=a}if(p){i.opt.treeView&&c&&(d+=c+i.opt.treeGlue);let e=i.buildOptionList(b,t+1,d),l=document.createElement("ul");l.replaceChildren(...e),a.appendChild(l)}l[l.length]=a})),0==t){i.empty()&&i.reset();let e=Object.keys(i.value);e.length>1&&e.indexOf("")>=0&&delete i.value[""],i.hdd.selected.innerHTML=i.opt.selectedLabel(i.value)}return l},d.empty=function(){let e=this;for(let t in e.value)return!1;return!0},d.reset=function(){let e=this;e.sindex=[],e.value={},e.clearClass("active"),e.hdd.options[""]?(e.hdd.options[""].classList.add("active"),e.value[""]=e.hdd.options[""].querySelector(".hybridddl").innerHTML,e.hdd.options[""].querySelector("input").checked=!0,e.sindex.push("")):e.value[""]=e.opt.defaultText,e.hdd.selected.innerHTML=e.opt.selectedLabel(e.value)},d.event=function(e,t,d){var i=e[t+"EventListener"].bind(e);Object.keys(d).forEach((function(e){["mouseenter","mouseleave"].indexOf(e)>=0?i(e,d[e],!0):i(e,d[e])}))},d.updateFromOriginal=function(){let e=this,t=[];if(!e.isDS){if(e.multi){let d=!0;for(let i=0;i<e.el.selectedOptions.length;i++)e.el.selectedOptions.item(i).value in e.value||(t.push(e.el.selectedOptions.item(i).value),d=!1);if(d)return}else{if(e.el.value in e.value)return;t.push(e.el.value)}e.addValue(t,!1)}},d.emit=function(t,d){let i=new e.CustomEvent(t,{bubbles:!0,detail:d});this.el.dispatchEvent(i)},d.originalElementFocus=function(){let e=this;if(!e.isDS){if(e.el.disabled)return;e.el.blur()}e.hdd.focus({preventScroll:!0}),e.hdd.classList.add("focus"),e.event(document,"add",{click:e.blur})},d.blurField=function(){this.hdd.classList.remove("focus")},d.nextOption=function(e){let t=Object.keys(this.hdd.options),d=e.length>0?t.indexOf(e[e.length-1]):-1;return d<t.length&&d++,d===t.length&&(d=0),t[d]},d.prevOption=function(e){let t=Object.keys(this.hdd.options),d=e.length>0?t.indexOf(e[0]):t.length;return d>=0&&d--,d<0&&(d=t.length-1),t[d]},d.keyboardNavigate=function(){let e,t=this,d=arguments[0];if(!t.el.disabled&&d&&d.keyCode)switch(d.preventDefault(),!0){case 40==d.keyCode&&"keydown"==d.type:t.hdd.classList.contains("active")?((t.hindex.length>0&&!t.multi||!d.shiftKey)&&t.clearClass("hover"),e=t.nextOption(t.hindex),t.hdd.options[e].classList.add("hover"),t.scroll(e,"down"),t.multi&&d.shiftKey?(t.hindex.push(e),t.opt.limitSelection>0&&(t.hindex=t.hindex.slice(-1*t.opt.limitSelection))):t.hindex[0]=e):1==t.opt.limitSelection?(e=t.nextOption(t.sindex),t.toggleValue([e],!0)):t.hasDd&&(t.hdd.classList.remove("focus"),t.open());break;case 38==d.keyCode&&"keydown"==d.type:if(t.hdd.classList.contains("active"))(t.hindex.length>0&&!t.multi||!d.shiftKey)&&t.clearClass("hover"),e=t.prevOption(t.hindex),t.hdd.options[e].classList.add("hover"),t.scroll(e,"up"),t.multi&&d.shiftKey?(t.hindex.push(e),t.opt.limitSelection>0&&(t.hindex=t.hindex.slice(-1*t.opt.limitSelection))):t.hindex[0]=e;else if(1==t.opt.limitSelection){let e=t.prevOption(t.sindex);t.toggleValue([e],!0)}else t.hasDd&&(t.hdd.classList.remove("focus"),t.open());break;case 13==d.keyCode&&"keydown"==d.type:case 32==d.keyCode&&"keydown"==d.type:!1===t.hdd.classList.contains("active")&&t.hasDd?(t.hdd.classList.remove("focus"),t.open()):(t.hindex.length>0&&t.toggleValue(t.hindex,!0),t.hasDd&&(t.closeSelect(!1),t.hdd.classList.add("focus")));break;case 27==d.keyCode&&"keydown"==d.type:t.hdd.classList.contains("active")&&t.closeSelect(!1),t.blurField();break;case 9==d.keyCode&&"keydown"==d.type:t.hdd.classList.contains("active")&&t.closeSelect(!1),t.blurField();let i,l,o=1*t.el.getAttribute("tabindex"),s=t.el.closest("form");if(null===s&&(s=document),null!=o&&""!=o)o+=1,i=s.querySelector('[tabindex="'+o+'"]');else if(s!==document)for(o in l=t.el,t.isDS&&(l=Object.keys(t.hdd.options),o=l[l.length-1],l=t.hdd.options[o].querySelector("input")),s.elements)if(s.elements[o]===l){do{o++}while(o<s.elements.length&&s.elements[o].classList.contains("hybridddin"));s.elements.length==o&&(o=0),i=s.elements[o].classList.contains("hybridddis")?s.elements[o].closest(".hybriddd-custom"):s.elements[o];break}if(null!=i)switch(!0){case i.classList.contains("hybriddd-custom"):i._hybriddd.originalElementFocus();break;case"text"===i.type:i.select();break;default:i.focus()}break;case 16==d.keyCode&&"keydown"==d.type:if(t.multi&&t.hdd.classList.contains("active")){let e=d.originalTarget;e||(e=d.target),e.classList.contains("hybriddd-option")||(e=e.closest(".hybriddd-option")),e&&(t.hindex=[e.querySelector("input").value]),t.listenForBulk||(t.event(t.hdd.ddlist,"add",{mouseenter:t.hover,mouseleave:t.hover,click:t.modClick,"hybrid-ddi-change":t.change}),t.listenForBulk=!0,t.listenModClick=!0)}break;case 16==d.keyCode&&"keyup"==d.type:t.listenForBulk&&(t.event(t.hdd.ddlist,"remove",{mouseenter:t.hover,mouseleave:t.hover,click:t.modClick,"hybrid-ddi-change":t.change}),t.listenForBulk=!1,t.listenModClick=!1);break;case 17==d.keyCode&&"keydown"==d.type:!t.listenModClick&&t.multi&&(t.event(t.hdd.ddlist,"add",{click:t.modClick,"hybrid-ddi-change":t.change}),t.listenModClick=!0);break;case 17==d.keyCode&&"keyup"==d.type:t.listenModClick&&(t.event(t.hdd.ddlist,"remove",{click:t.modClick,"hybrid-ddi-change":t.change}),t.listenModClick=!1,t.clearClass("mod-ctrl"))}},d.optionModClick=function(e){let t,d=this,i=e.target.closest(".hybriddd-option");if(i&&(t=i.querySelector("input")),e&&e.target){if(!e.ctrlKey&&!e.shiftKey)return d.listenModClick&&(d.event(d.hdd.ddlist,"remove",{click:d.modClick,"hybrid-ddi-change":d.change}),d.listenModClick=!1),d.listenForBulk&&(d.event(d.hdd.ddlist,"remove",{mouseenter:d.hover,mouseleave:d.hover}),d.listenForBulk=!1),void d.clearClass("mod-ctrl");t&&(t.checked=!t.checked,t.checked||t.classList.remove("mod-ctrl"),t.dispatchEvent(new Event("hybrid-ddi-change",{bubbles:!0})),t.checked&&t.classList.add("mod-ctrl"))}},d.scroll=function(e,t="up"){let d=this,i=d.hdd.options[e].querySelector("label").getBoundingClientRect(),l=d.hdd.ddlist.getBoundingClientRect();if(i.top<l.top||i.bottom>l.bottom)switch(t){case"up":l.top>i.top?d.hdd.ddlist.scrollTop-=i.height:l.bottom<i.bottom&&(d.hdd.ddlist.scrollTop=i.bottom-l.bottom);break;case"down":l.bottom<i.bottom?d.hdd.ddlist.scrollTop+=i.height:l.top>i.top&&(d.hdd.ddlist.scrollTop=0)}},d.inputChange=function(){let e=this,t=arguments[0],d=[],i=!1;if(t&&t.target){if(i=t.target.classList.contains("mod-ctrl"),"change"==t.type&&i)return t.target.classList.remove("mod-ctrl"),!1;if(e.hindex.length>0&&(d=[...e.hindex]),t.target.checked&&""==t.target.value)i||e.removeValue([...e.sindex],!0);else if(e.opt.treeView&&(e.opt.limitSelection<0||e.opt.limitSelection>e.sindex.length)){let l,o,s=!0,n=t.target.closest(".hybriddd-option"),r=n.querySelectorAll("input");for(o of r.values())o.checked=t.target.checked,i||(t.target.checked?d.push(o.value):e.removeValue([o.value])),o.closest(".hybriddd-option").classList.remove("partial");for(;n;)o=n.querySelector("input"),s||o.checked||n.querySelectorAll("label input").length-n.querySelectorAll("label input:checked").length!=1||(o.checked=!0,d.push(o.value),n.classList.remove("partial")),r=n.querySelectorAll("input:checked"),l=n.querySelectorAll("input"),o.checked&&1==r.length&&l.length>1?(n.classList.remove("partial"),o.checked=!1,i||e.removeValue([o.value])):r.length>0&&l.length!=r.length?(n.classList.add("partial"),i||e.removeValue([o.value])):n.classList.remove("partial"),n=n.parentNode.closest(".hybriddd-option"),s=!1;i||e.addValue(d,!0)}else i||(d.push(t.target.value),t.target.checked?e.addValue(d,!0):e.removeValue(d,!0));switch(!0){case"hybrid-ddi-change"==t.type:case t.shiftKey&&1==t.shiftKey:break;default:e.closeSelect(!1)}}},d.toggleValue=function(e,t){let d=this;d.hdd.options[e[0]].querySelector("input").checked?d.removeValue(e,t):d.addValue(e,t)},d.addValue=function(e,t=!1){let d=this;if(1===d.opt.limitSelection)d.sindex.length>0&&d.hdd.options[d.sindex[0]].classList.remove("active"),d.sindex=e;else{if(1==d.sindex.length&&0==d.sindex[0].length?(d.hdd.options[""].classList.remove("active"),d.hdd.options[""].querySelector("input").checked=!1,d.sindex=e):d.sindex=d.sindex.concat(e),d.opt.limitSelection>0){for(let e=d.opt.limitSelection;e<d.sindex.length;e++)d.hdd.options[d.sindex[e]].querySelector("input").checked=!1;d.sindex=d.sindex.slice(0,d.opt.limitSelection)}d.clearClass("hover"),d.hindex=[]}d.value={},d.sindex.forEach((e=>{d.value[e]=d.hdd.options[e].querySelector(".hybridddl").innerHTML,d.hdd.options[e].querySelector("input").checked=!0,d.hdd.options[e].classList.add("active")})),d.empty()&&d.reset(),d.isDS||d.updateOriginal(),d.hdd.selected.innerHTML=d.opt.selectedLabel(d.value),t&&d.emit("change")},d.removeValue=function(e,t=!1){let d,i=this;e.forEach((e=>{i.hdd.options[e].classList.remove("active"),i.hdd.options[e].querySelector("input").checked=!1,d=i.sindex.indexOf(e),d>=0&&(i.sindex.splice(d,1),delete i.value[e])})),0==i.sindex.length&&(i.hdd.options[""]?(i.sindex=[""],i.value={"":i.hdd.options[""].querySelector(".hybridddl").innerHTML},i.hdd.options[""].querySelector("input").checked=!0,i.hdd.options[""].classList.add("active")):i.value={"":i.opt.defaultText}),i.empty()&&i.reset(),i.isDS||i.updateOriginal(),i.hdd.selected.innerHTML=i.opt.selectedLabel(i.value),t&&i.emit("change")},d.updateOriginal=function(){let e=this;Object.keys(e.value).forEach((t=>{e.el.selectedIndex=-1,e.el.querySelector('option[value="'+t+'"]').selected=!0}))},d.optionHover=function(){let e,t,d=this,i=arguments[0];if(i.shiftKey){if(t=i.target.classList.contains("hybriddd-option")?i.target:i.target.closest(".hybriddd-option"),t){switch(e=t.querySelector("input").value,i.type){case"mouseleave":d.event(d.hdd.ddlist,"remove",{mouseleave:d.hover}),e&&(d.hindex=[e]);break;case"mouseenter":d.hindex.includes(e)?(e=d.hindex[d.hindex.length-1],d.hindex=d.hindex.slice(0,-1)):e&&d.hindex.push(e),d.opt.limitSelection>0&&(d.hindex=d.hindex.slice(0,d.opt.limitSelection))}e&&!d.sindex.includes(e)&&d.hdd.options[e].classList.add("hover")}}else d.hindex.length>0&&(d.clearClass("hover"),d.hindex=[])},d.clearClass=function(e){let t=this;"string"==typeof e&&e.length>0&&t.hdd.querySelectorAll("."+e).forEach((t=>{t.classList.remove(e)}))},d.openSelect=function(){let e=this,t=arguments[0];if(!e.el.disabled){if(t&&t.target){if(t.target.classList.contains("hybriddd-options")||t.target.closest(".hybriddd-options"))return;t.stopPropagation(),e.emit("hybrid-dd-"+t.type)}if(e.hdd.classList.contains("active"))e.closeSelect();else{if(e.hdd.listwrap.style.setProperty("--hybriddd-top",e.hdd.offsetHeight+"px"),e.hdd.classList.add("active"),e.hdd.ddlist.style["min-width"]||(e.hdd.ddlist.style["min-width"]=e.hdd.ddlist.offsetWidth+12+"px"),!e.hdd.listwrap.style.height&&(e.hdd.listwrap.style.height=e.hdd.ddlist.offsetHeight+"px",e.hdd.listwrap.style.width="100%",e.hdd.ddlist.children[1])){let t=e.hdd.ddlist.children[1].querySelector("label");e.hdd.listwrap.style.setProperty("--hybriddd-item-height",t.offsetHeight+"px")}e.event(document,"add",{click:e.close}),e.event(e.hdd,"add",{keyup:e.keyNav}),e.event(document,"add",{"hybrid-dd-click":e.close})}}},d.closeSelect=function(e){let t=this,d=arguments[0],i=arguments[1];if(!(d&&d.target&&d.target.classList.contains("hybriddd-option"))){if(i){if(i.target.isSameNode(t.el))return;if(t.multi&&(i.ctrlKey||i.shiftKey))return;if(i.target.parentNode.classList&&i.target.parentNode.classList.contains("hybriddd-group"))return;if(i.target.closest(".hybriddd-option"))return}t.hdd.classList.remove("active"),t.clearClass("hover"),t.hindex=[],t.event(document,"remove",{click:t.close}),t.event(document,"remove",{"hybrid-dd-click":t.close}),t.event(t.hdd,"remove",{keyup:t.keyNav}),t.listenForBulk&&(t.event(t.hdd.ddlist,"remove",{mouseenter:t.hover}),t.listenForBulk=!1),e&&t.blur()}},t}));